<% if (typeof distribuidorAgregado !=='undefined' && distribuidorAgregado) { %>
  <div class="modal fade" id="modalDistribuidorAgregado" tabindex="-1" aria-labelledby="modalDistribuidorLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="modalDistribuidorLabel">Distribuidor agregado</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
        </div>
        <div class="modal-body text-center">
          <i class="bi bi-check-circle-fill text-success fs-1"></i>
          <p class="mt-3">El distribuidor se ha agregado correctamente.</p>
        </div>
      </div>
    </div>
  </div>
<% } %>

<% if (typeof modalEstado !=='undefined' && modalEstado) { %>
  <div class="modal fade" id="modalCambioEstadoExito" tabindex="-1" aria-labelledby="modalCambioEstadoExitoLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="modalCambioEstadoExitoLabel">Cambio de Estado</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
        </div>
        <div class="modal-body text-center">
          <i class="bi bi-info-circle-fill text-warning fs-1"></i>
          <p class="mt-3">El estado del distribuidor ha sido actualizado correctamente.</p>
        </div>
      </div>
    </div>
  </div>
<% } %>

<% if (typeof distribuidorEditado !=='undefined' && distribuidorEditado) { %>
  <div class="modal fade" id="modalDistribuidorEditado" tabindex="-1" aria-labelledby="modalDistribuidorEditadoLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="modalDistribuidorEditadoLabel">Distribuidor actualizado</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
        </div>
        <div class="modal-body text-center">
          <i class="bi bi-pencil-square text-warning fs-1"></i>
          <p class="mt-3">Los datos del distribuidor han sido actualizados correctamente.</p>
        </div>
      </div>
    </div>
  </div>
<% } %>

<% if (typeof usuario !== 'undefined' && usuario) { %>
  <div class="modal fade" id="modalImagenPerfil" tabindex="-1" aria-labelledby="modalImagenPerfilLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <form id="formImagenPerfil" class="modal-content" action="/usuarios/<%= usuario.id %>/imagen" method="POST" enctype="multipart/form-data">
        <div class="modal-header">
          <h5 class="modal-title" id="modalImagenPerfilLabel">Actualizar imagen de perfil</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
        </div>
        <div class="modal-body">
          <input type="file" id="imagenPerfil" name="imagenPerfil" accept="image/*" class="form-control" required>
          <div class="alert alert-danger mt-2 d-none" id="errorImagenPerfil"></div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn" id="btnSubirImagen">Subir Imagen</button>
        </div>
      </form>
    </div>
  </div>
<% } %>


<% if (typeof notificacionPagoPendiente !=='undefined' && notificacionPagoPendiente) { %>
  <div class="modal fade" id="modalNotificacionPago" tabindex="-1" aria-labelledby="modalNotificacionPagoLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="modalNotificacionPagoLabel">Correo enviado exitosamente</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
        </div>
        <div class="modal-body text-center">
          <i class="bi bi-check-circle-fill text-success fs-1"></i>
          <p class="mt-3">Se ha enviado una notificación de pago pendiente al cliente.</p>
        </div>
      </div>
    </div>
  </div>
<% } %>

<% if (typeof notificacionVacacionesAprobadas !=='undefined' && notificacionVacacionesAprobadas) { %>
  <div class="modal fade" id="modalNotificacionVacaciones" tabindex="-1" aria-labelledby="modalNotificacionVacacionesLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="modalNotificacionVacacionesLabel">Solicitud aprobada</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
        </div>
        <div class="modal-body text-center">
          <i class="bi bi-check-circle-fill text-success fs-1"></i>
          <p class="mt-3">La solicitud de vacaciones ha sido aprobada y el colaborador ha sido notificado por correo electrónico.</p>
        </div>
      </div>
    </div>
  </div>
<% } %>

<% if (typeof notificacionVacacionesDenegadas !=='undefined' && notificacionVacacionesDenegadas) { %>
  <div class="modal fade" id="modalNotificacionVacacionesDenegadas" tabindex="-1" aria-labelledby="modalNotificacionVacacionesDenegadasLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="modalNotificacionVacacionesDenegadasLabel">Solicitud denegada</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
        </div>
        <div class="modal-body text-center">
          <i class="bi bi-x-circle-fill text-danger fs-1"></i>
          <p class="mt-3">La solicitud de vacaciones ha sido denegada y el colaborador ha sido notificado por correo electrónico.</p>
        </div>
      </div>
    </div>
  </div>
<% } %>



<% if (typeof usuario !== 'undefined' && usuario) { %>
  ...
  <!-- Modal de confirmación de imagen -->
  <div class="modal fade" id="modalImagenConfirmacion" tabindex="-1" aria-labelledby="modalImagenConfirmacionLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="modalImagenConfirmacionLabel">Imagen actualizada</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
        </div>
        <div class="modal-body text-center">
          <i class="bi bi-check-circle-fill text-success fs-1"></i>
          <p class="mt-3">Tu imagen de perfil se ha actualizado correctamente.</p>
        </div>
      </div>
    </div>
  </div>
<% } %>



<script>
  document.addEventListener('DOMContentLoaded', function () {
    const formImagenPerfil = document.getElementById('formImagenPerfil');
    const errorImagenPerfil = document.getElementById('errorImagenPerfil');
    const modalImagenPerfil = document.getElementById('modalImagenPerfil');
    const btnSubirImagen = document.getElementById('btnSubirImagen');


    const modales = [
      'modalDistribuidorAgregado',
      'modalCambioEstadoExito',
      'modalDistribuidorEditado',
      'modalNotificacionPago',
      'modalNotificacionVacaciones',
      'modalNotificacionVacacionesDenegadas'
    ];

 
    modales.forEach(id => {
      const modalEl = document.getElementById(id);
      if (modalEl) {
        const modal = new bootstrap.Modal(modalEl);
        modal.show();

        // Auto cerrar a los 4 segundos
        setTimeout(() => {
          const instance = bootstrap.Modal.getInstance(modalEl);
          if (instance) instance.hide();
        }, 4000);
      }
    });


    if (formImagenPerfil) {
      formImagenPerfil.addEventListener('submit', function (e) {
        e.preventDefault();

        errorImagenPerfil.classList.add('d-none');
        btnSubirImagen.disabled = true;
        btnSubirImagen.innerHTML = 'Subiendo...';

        const formData = new FormData(formImagenPerfil);

        fetch(formImagenPerfil.action, {
          method: 'POST',
          body: formData
        })
          .then(response => response.json())
          .then(data => {
  if (data.error) {
    errorImagenPerfil.textContent = data.error;
    errorImagenPerfil.classList.remove('d-none');
  } else if (data.url) {
    const profileImages = document.querySelectorAll('.custom-block-profile-image, .profile-image');
    profileImages.forEach(img => {
      img.src = data.url;
    });

    const modalInstance = bootstrap.Modal.getInstance(modalImagenPerfil);
    if (modalInstance) modalInstance.hide();

    // ✅ Mostrar solo en éxito
    const confirmModal = document.getElementById('modalImagenConfirmacion');
    if (confirmModal) {
      const modalConfirmacion = new bootstrap.Modal(confirmModal);
      modalConfirmacion.show();

      // Auto cerrar solo si fue llamado
      setTimeout(() => {
        modalConfirmacion.hide();
      }, 4000);
    }
  }
})
          .catch(error => {
            console.error('Error:', error);
            errorImagenPerfil.textContent = 'Error al subir la imagen. Inténtalo de nuevo.';
            errorImagenPerfil.classList.remove('d-none');
          })
          .finally(() => {
            btnSubirImagen.disabled = false;
            btnSubirImagen.innerHTML = 'Subir Imagen';
          });
      });
    }
  });
</script>

