<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="Tooplate">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    <link href="/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/bootstrap-icons.css" rel="stylesheet">
    <link href="/css/apexcharts.css" rel="stylesheet">
    <link href="/css/tooplate-mini-finance.css" rel="stylesheet">
    <link href="/css/custom-styles.css" rel="stylesheet">

    <style>
    /* Estilos para el dropdown personalizado */
    #profileButton {
        cursor: pointer !important;
        border: none !important;
        background: none !important;
        padding: 0 !important;
    }
    
    #profileButton:focus {
        outline: none !important;
        box-shadow: none !important;
    }
    
    .profile-image {
        max-width: 40px;
        max-height: 40px;
        border-radius: 50%;
        object-fit: cover;
        border: 2px solid #ffc107;
    }
    
    #profileMenu {
        position: absolute !important;
        right: 0 !important;
        top: 100% !important;
        z-index: 1050 !important;
        min-width: 250px !important;
        border: 1px solid #dee2e6 !important;
        border-radius: 8px !important;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15) !important;
    }
    </style>

    <!-- DataTables CSS -->
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">
<!-- AOS CSS -->
<link href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css" rel="stylesheet">


</head>

<header class="navbar sticky-top flex-md-nowrap">
  <div class="col-md-3 col-lg-3 me-0 px-3 fs-6 d-flex align-items-center">
      <a class="navbar-brand d-flex align-items-center" href="/">
          <img src="/images/LogoEBS.webp" alt="EL BUEN SABOR" class="img-fluid" style="max-height: 70px;">
          <span class="ms-2 fw-bold">El Buen Sabor</span>
      </a>
  </div>

  <button class="navbar-toggler position-absolute d-md-none collapsed" type="button" data-bs-toggle="collapse"
      data-bs-target="#sidebarMenu" aria-controls="sidebarMenu" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
  </button>

  <div class="navbar-nav me-lg-2">
      <div class="dropdown px-3" id="profileDropdown">
          <button class="btn btn-link nav-link p-0" type="button" id="profileButton" onclick="toggleDropdown()">
              <img src="<%= typeof usuario !== 'undefined' && usuario && usuario.imagen_url ? usuario.imagen_url : '/images/3135768.png' %>"
                  class="profile-image img-fluid" alt="">
          </button>
          <ul class="dropdown-menu bg-white shadow" id="profileMenu" style="display: none;">
              <li>
                  <div class="dropdown-menu-profile-thumb d-flex">
                      <img src="<%= typeof usuario !== 'undefined' && usuario && usuario.imagen_url ? usuario.imagen_url : '/images/3135768.png' %>"
                          class="profile-image img-fluid me-3" alt="">
                      <div class="d-flex flex-column">
                          <small>
                              <%= typeof usuario !=='undefined' && usuario ? usuario.nombre : 'Usuario' %>
                          </small>
                          <a href="#">
                              <%= typeof usuario !=='undefined' && usuario ? usuario.correo : 'correo@ejemplo.com' %>
                          </a>
                          <small><strong>
                                  <%= typeof rol_name !=='undefined' ? rol_name : 'Usuario' %>
                              </strong></small>
                      </div>
                  </div>
              </li>
              <li><a class="dropdown-item" href="/profile"><i class="bi-person me-2"></i>Mi Perfil</a></li>
              
              <li class="border-top mt-3 pt-2 mx-4">
                  <a class="dropdown-item ms-0 me-0" href="/logout" onclick="console.log('Logout clicked'); return true;">LOGOUT</a>
              </li>
              <!-- Botón de logout alternativo -->
              <li class="border-top mt-2 pt-2 mx-4">
                  <button class="dropdown-item ms-0 me-0 btn btn-link text-danger" onclick="window.location.href='/logout'; console.log('Logout alternativo clicked');">
                      <i class="bi-box-arrow-right me-2"></i>CERRAR SESIÓN
                  </button>
              </li>
          </ul>
      </div>
  </div>
</header>


<body>
    <!-- Contenedor de toda la aplicación -->
    <div class="container-fluid">
      <div class="row">
  
        <!-- Sidebar (navbar lateral) -->
        <%- include('../partials/navbar') %>
  
        <!-- Contenido principal -->
        <main class="main-wrapper col-md-9 col-lg-10 ms-sm-auto px-md-4 py-4 ">
          <%- body %>
        </main>
  
      </div>
    </div>
  
    <%- include('../partials/modals') %>
    

  </body>

  <script src="/js/jquery.min.js"></script>
  <!-- Esta línea es la del CDN -->

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>


  <script src="/js/apexcharts.min.js"></script>
  <script src="/js/custom.js"></script>
  <!-- jQuery (ya lo tenés) -->
<!-- DataTables JS -->
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
<!-- AOS JS -->
<script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>
<script src="/js/initAOS.js"></script>

<script>
// Función para alternar el dropdown del perfil
function toggleDropdown() {
    console.log('toggleDropdown() ejecutada');
    const menu = document.getElementById('profileMenu');
    const button = document.getElementById('profileButton');
    
    if (menu.style.display === 'none' || menu.style.display === '') {
        menu.style.display = 'block';
        console.log('Dropdown abierto');
    } else {
        menu.style.display = 'none';
        console.log('Dropdown cerrado');
    }
}

// Cerrar dropdown cuando se hace clic fuera
document.addEventListener('click', function(event) {
    const dropdown = document.getElementById('profileDropdown');
    const menu = document.getElementById('profileMenu');
    
    if (!dropdown.contains(event.target)) {
        menu.style.display = 'none';
    }
});

// Debug para el botón de logout
document.addEventListener('DOMContentLoaded', function() {
    console.log('=== DEBUG: Layout cargado ===');
    
    const profileButton = document.getElementById('profileButton');
    const profileMenu = document.getElementById('profileMenu');
    const logoutLink = document.querySelector('a[href="/logout"]');
    
    console.log('Profile button encontrado:', !!profileButton);
    console.log('Profile menu encontrado:', !!profileMenu);
    console.log('Logout link encontrado:', !!logoutLink);
    
    if (profileButton) {
        profileButton.addEventListener('click', function(e) {
            console.log('Profile button clicked via event listener');
        });
    }
    
    if (logoutLink) {
        logoutLink.addEventListener('click', function(e) {
            console.log('Logout link clicked via event listener');
        });
    }
});
</script>

</html>


